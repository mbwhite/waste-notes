{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * BrowserFS's main entry point.\n * It installs all of the needed polyfills, and requires() the main module.\n */\nimport global from './core/global';\n\n// IE substr does not support negative indices\nif ('ab'.substr(-1) !== 'b') {\n  String.prototype.substr = function(substr: (start: number, length?: number) => string) {\n    return function(this: string, start: number, length?: number): string {\n      // did we get a negative start, calculate how much it is from the\n      // beginning of the string\n      if (start < 0) {\n        start = this.length + start;\n      }\n      // call the original function\n      return substr.call(this, start, length);\n    };\n  }(String.prototype.substr);\n}\n\n// Only IE10 has setImmediate.\nif (typeof setImmediate === 'undefined') {\n  const gScope = global;\n  const timeouts: (() => void)[] = [];\n  const messageName = \"zero-timeout-message\";\n  const canUsePostMessage = function() {\n    if (typeof gScope.importScripts !== 'undefined' || !gScope.postMessage) {\n      return false;\n    }\n    let postMessageIsAsync = true;\n    const oldOnMessage = gScope.onmessage;\n    gScope.onmessage = function() {\n      postMessageIsAsync = false;\n    };\n    gScope.postMessage('', '*');\n    gScope.onmessage = oldOnMessage;\n    return postMessageIsAsync;\n  };\n  if (canUsePostMessage()) {\n    gScope.setImmediate = function(fn: () => void) {\n      timeouts.push(fn);\n      gScope.postMessage(messageName, \"*\");\n    };\n    const handleMessage = function(event: MessageEvent) {\n      if (event.source === self && event.data === messageName) {\n        if (event.stopPropagation) {\n          event.stopPropagation();\n        } else {\n          event.cancelBubble = true;\n        }\n        if (timeouts.length > 0) {\n          const fn = timeouts.shift()!;\n          return fn();\n        }\n      }\n    };\n    if (gScope.addEventListener) {\n      gScope.addEventListener('message', handleMessage, true);\n    } else {\n      gScope.attachEvent('onmessage', handleMessage);\n    }\n  } else if (gScope.MessageChannel) {\n    // WebWorker MessageChannel\n    const channel = new gScope.MessageChannel();\n    channel.port1.onmessage = (event: any) => {\n      if (timeouts.length > 0) {\n        return timeouts.shift()!();\n      }\n    };\n    gScope.setImmediate = (fn: () => void) => {\n      timeouts.push(fn);\n      channel.port2.postMessage('');\n    };\n  } else {\n    gScope.setImmediate = function(fn: () => void) {\n      return setTimeout(fn, 0);\n    };\n  }\n}\n\n// Polyfill for Uint8Array.prototype.slice.\n// Safari and some other browsers do not define it.\nif (typeof(ArrayBuffer) !== 'undefined' && typeof(Uint8Array) !== 'undefined') {\n  if (!Uint8Array.prototype['slice']) {\n    Uint8Array.prototype.slice = function(this: Uint8Array, start: number = 0, end: number = this.length): Uint8Array {\n      const self: Uint8Array = this;\n      if (start < 0) {\n        start = this.length + start;\n        if (start < 0) {\n          start = 0;\n        }\n      }\n      if (end < 0) {\n        end = this.length + end;\n        if (end < 0) {\n          end = 0;\n        }\n      }\n      if (end < start) {\n        end = start;\n      }\n      return new Uint8Array(self.buffer, self.byteOffset + start, end - start);\n    };\n  }\n}\n\nexport * from './core/browserfs';\n"]}